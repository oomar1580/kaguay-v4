import axios from "axios";
import fs from "fs";
import path from "path";
import process from "process";

export default {
  name: "ูุงุฆูุฉ",
  author: "Thiแปu Trung Kiรชn",
  cooldowns: 50,
  description: "ูุงุฆูุฉ ุงูุฃูุงูุฑ",
  role: "member",
  aliases: ["menu", "ูุงุฆูู"],
  execute: async ({ api, event }) => {
    api.setMessageReaction("๐", event.messageID, () => {}, true);

    // ุงููุต ุงูุฎุงุต ุจุงููุงุฆูุฉ
    const messageText = `
    `\t\t\t\t\t\t\tเผโพููููุงุฆูููููููููุฉ ุงูููุงูุงููููุฑโฝเผ 
  

  เผบโฟูููููุฆููููุฉ ุงูุฃูููุนููุงุจโฟเผป
  
  โุชูููู  โุฑุฃุณ_ุฃู_ูุฌู  โุดุงุฑุงุช  โุญุฌุฑ_ูุฑูุฉ_ููุต  โุดุฎุตูุงุช โุงูููุฌู โุงูุงุณุฑุน โุงูุณ_ุงู โุญูููุฉ&ุฌุฑุฃุฉ โูุฒูุฑุฉ โุชุฎููู 

          
เผบููููุฆูููุฉ ุงูุงูููููุชููููุตููุงุฏเผป

โุนูู โูุฏูุฉ โููุงุท โุฑุตูุฏู โุตุฑู โุชูุจ โููู
          
เผบูููููุฆููููุฉ ุงููููููููุฎููููุฏููููุงุชเผป
  
 โบุฅุฒุงูุฉ_ุงูุฎูููุฉ  โบุจูุงูุงุช โบุงูุฏู โบุชุนุงูู  
 โบูุฒุฌ โบุงุฑุช โบุชูููู โบุชุฑุฌูู โบุชุทููู โบุชุทููู2 โบุฐูุฑููู โบุชุญููู โบุบูู โบููุชููุจ โบุฑุงุจุท โบุฑุงุจุท2 โบุฑุงุจุท3  โบุฑุงุจุท4 โบุฃุฎุจุงุฑ_ุงูุฃููู โบุฃูุจุณุชุงูุช โบููุณุจูู โบุชุญููู 
 โบุงูุทูุณ โบุงูุชุตุงุต โบุถููููู โบููุตู โบุบูู โบุตูุฑ โบุฌูุฌู โบูุฑุขู โบูููุฉ โบุชูุฏ โบุงูุงูุฑ โบุนูุฑู โบููููุจูุฏูุง โบุฅูููุฌู โบุงููุนุฑู โบุฏูุฌ โบุฒุฎุฑูุฉ  โบุฌูุฏุฉ  โบุชุญููู โบุขูุฏู โบูุนูููุงุชู โบูุตูุญุฉ โบุงุทุฑุฏููู โบุงูุถูุงู โบูุดุบูู โบููุบู
           
เผบโฟูููููุฆููููุฉ ุงูููููููุฐููููุงุกโฟเผป
   
โุชุฎููู โุชุฎููู2 โุงุฑุณูู โุงุฑุณูู2 โูุงุบููุง โุฐูุงุก 
โููุฌู โุชุดุงุจู โุจุฑููุจุช
           
เผบโฟูููููุฆููููุฉ ุงูููููููููุชูููุนูููุฉโฟเผป
  
โุฑูุต โุงููุงู โูุฑุงุด โุดุงุฐ โุณูุฌูุง โุฃููู2 โุงูุชุจุงุณ โุดุฎุตูุชู โููุทุน_ุฃููู โุฅุนุฌุงุจ โุฒูุฌููู โููุฒูู โุงุตูุนู โุขูููู โุนูููู โุญุถู โุงุนุฌุงุจ โุฃุฒูุงุก โูููู โููุจูุณ โูุจุฑ โูุชูุงุช โูุฑุญุงุถ โุฒูุงุฌ โุบููุถ โุทูุจ โูุงุฐุง_ูู โุฎูููุงุช โุณุจูุฏุฑูุงู โุดูู โูุทููุจ โุงูููุงุช โุชุญุฏู โุดุฎุตูุชู_ุงูุณูููุงุฆูุฉ โุฒูุฌุฉ
โ ุฒูุฌููู2 โุฒูุฌููู3 โุฒูุฌููู4 โุณูููู โุนูุงู2 โุญููุงูู โูุจูุฉ โุญููุงูู โุถุฑุจ 
เผบโฟูููููุฆููููุฉ ุงูููููููููููุทููููุฑโฟเผป
  
โูุจูู โุทูุจุงุช โุบุงุฏุฑู โุงููุทูุฑ โููุงููุฉ โุงููุชุฌุฑ โุขุฏูู โุฑุฏ_ุงูุขุฏูู โุชุฌุฑุจุฉ โุถุจุท_ุงูุจุงุฏุฆุฉ โูููุฏ โุจุงูู โุงููุฌููุนุฉ โุชุตููุฉ โุฅุดุนุงุฑ โุงูุจุชุงูู โฺคูู โุดุฑุญ โุงููุณุชุฎุฏู โูุดุงุฑูุฉ โูุงุณุช
          
เผบูููููุฆููููุฉ ุงูููููููุฌููููููุนููุฉเผป
  
โุญูุงูุฉ_ุงูุฅุณู โุญูุงูุฉ_ุงูุตูุฑุฉ โุถุจุท_ุฅูููุฌู โุถุจุท_ุงูุตูุฑุฉ โุถุจุท_ุงูุฅุณู
          
เผบโฟุฃููุขูููุฑ ุฅุถููุขููููููุฉูโฟเผป

 โูุซูุฑ โุชุทุจููุงุช โุดูุชู 

\t\t<โโโ โ โฉ โฃ โช โ โโโโ>
    `;

    // ุชุญุฏูุฏ ูุณุงุฑ ุงูุตูุฑุฉ ุงููุคูุชุฉ
    const imagePath = path.join(process.cwd(), "cache", "neko_image.png");

    try {
      // ุฌูุจ ุจูุงูุงุช ุงูุตูุฑุฉ ูู ุงูู API
      const apiResponse = await axios.get(
        "https://jerome-web.gleeze.com/service/api/neko?type=png&amount=1"
      );

      if (apiResponse.data.success && apiResponse.data.data.length > 0) {
        const nekoImageUrl = apiResponse.data.data[0].url; // ุฑุงุจุท ุงูุตูุฑุฉ
        const nekoArtist = apiResponse.data.data[0].artist_name; // ุงุณู ุงูููุงู
        const nekoSource = apiResponse.data.data[0].source_url; // ุฑุงุจุท ุงููุตุฏุฑ

        // ุชุญููู ุงูุตูุฑุฉ
        const response = await axios({
          url: nekoImageUrl,
          responseType: "stream",
        });

        // ุญูุธ ุงูุตูุฑุฉ ูู ุงููุณุงุฑ ุงููุคูุช
        const writer = fs.createWriteStream(imagePath);
        response.data.pipe(writer);

        writer.on("finish", () => {
          // ุฅุฑุณุงู ุงููุงุฆูุฉ ูุน ุงูุตูุฑุฉ
          api.sendMessage(
            {
              body: `${messageText}`,
              attachment: fs.createReadStream(imagePath),
            },
            event.threadID,
            () => {
              // ุญุฐู ุงูุตูุฑุฉ ุจุนุฏ ุงูุฅุฑุณุงู
              fs.unlinkSync(imagePath);
            },
            event.messageID
          );
        });

        writer.on("error", (err) => {
          console.error("Error writing the image to disk: ", err);
          api.sendMessage(
            "ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุญูุธ ุงูุตูุฑุฉ.",
            event.threadID,
            event.messageID
          );
        });
      } else {
        api.sendMessage(
          "โ๏ธ | ูู ูุชู ุงูุนุซูุฑ ุนูู ุตูุฑุฉ ููุงุณุจุฉ.",
          event.threadID,
          event.messageID
        );
      }
    } catch (error) {
      console.error("Error fetching the neko image: ", error);
      api.sendMessage(
        "โ๏ธ | ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุฌูุจ ุงูุตูุฑุฉ.",
        event.threadID,
        event.messageID
      );
    }
  },
};
